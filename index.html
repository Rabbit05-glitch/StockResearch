<script>
    $(document).ready(function() {
        // Load CSV data for Tradebook and StockMarketHistory from GitHub
        loadCSVData('https://raw.githubusercontent.com/Rabbit05-glitch/StockResearch/main/CSV/Tradebook.csv', '#tradebookTable');
        loadCSVData('https://raw.githubusercontent.com/Rabbit05-glitch/StockResearch/main/CSV/StockMarketHistory.csv', '#stockmarketTable');
    });

    // Load data from CSV and populate table dynamically
    function loadCSVData(file, tableId) {
        $.get(file, function(data) {
            var parsedData = Papa.parse(data, { header: true }).data;

            var tableBody = $(tableId + ' tbody');
            var tableHeader = $(tableId + ' thead');

            if (parsedData.length > 0) {
                // Dynamically generate table headers based on CSV columns
                var headers = Object.keys(parsedData[0]);
                var headerRow = '<tr>';
                headers.forEach(function(header) {
                    headerRow += `<th>${header}</th>`;
                });
                headerRow += '</tr>';
                tableHeader.html(headerRow);

                // Populate the table rows with CSV data
                parsedData.forEach(function(row) {
                    var tableRow = '<tr>';
                    headers.forEach(function(header) {
                        var value = row[header];
                        if (header.toLowerCase() === 'long or short' && value && value.toLowerCase().includes('long')) {
                            tableRow += `<td class="long">${value}</td>`;
                        } else if (header.toLowerCase() === 'long or short' && value && value.toLowerCase().includes('short')) {
                            tableRow += `<td class="short">${value}</td>`;
                        } else {
                            tableRow += `<td>${value}</td>`;
                        }
                    });
                    tableRow += '</tr>';
                    tableBody.append(tableRow);
                });
                $(tableId).DataTable(); // Initialize DataTable for sorting, searching, etc.
            }
        });
    }

    // Filter data from both tables based on search input
    function filterData() {
        var input = document.getElementById('searchInput').value.toLowerCase();
        var tables = [$('#tradebookTable'), $('#stockmarketTable')];
        
        tables.forEach(function(table) {
            table.find('tbody tr').each(function() {
                var rowText = $(this).text().toLowerCase();
                if (rowText.indexOf(input) === -1) {
                    $(this).hide();
                } else {
                    $(this).show();
                }
            });
        });
    }
</script>
